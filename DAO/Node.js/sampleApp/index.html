<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
  <title>Bootstrap Example</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.socket.io/4.5.3/socket.io.min.js" integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi" crossorigin="anonymous"></script>
  <script>
    /**클라이언트 소켓 연결**/
    const socket = io('ws://127.0.0.1:3000');

    /**클라이언트 소켓 이벤트**/
    socket.on('insert',msg=>{
      document.getElementById('result').innerText=JSON.stringify(msg)
    })
    socket.on('select',msg=>{
      document.getElementById('result').innerText=JSON.stringify(msg)
    })
    socket.on('delete',msg=>{
      document.getElementById('result').innerText=JSON.stringify(msg)
    })
    socket.on('update',msg=>{
      document.getElementById('result').innerText=JSON.stringify(msg)
    })

    /**클라이언트 조작(신경 안 써도 돼요)**/
    function dao_insert() {
      document.getElementById('option').innerText='insert'
      document.getElementById('dao').innerHTML=`
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">table</span>
        <input id="table" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">field</span>
        <input id="field" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">values</span>
        <input id="values" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <input type="button" class="btn btn-dark" value="commit" onclick="commit(0)">
      `
    }
    function dao_select() {
      document.getElementById('option').innerText='select'
      document.getElementById('dao').innerHTML=`
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">table</span>
        <input id="table" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">columns</span>
        <input id="columns" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">where</span>
        <input id="where" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <input type="button" class="btn btn-dark" value="commit" onclick="commit(1)">
      `
    }
    function dao_update() {
      document.getElementById('option').innerText='update'
      document.getElementById('dao').innerHTML=`
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">table</span>
        <input id="table" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">set</span>
        <input id="set" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">where</span>
        <input id="where" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <input type="button" class="btn btn-dark" value="commit" onclick="commit(2)">
      `
    }
    function dao_delete() {
      document.getElementById('option').innerText='delete'
      document.getElementById('dao').innerHTML=`
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">table</span>
        <input id="table" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-default">where</span>
        <input id="where" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
      </div>
      <input type="button" class="btn btn-dark" value="commit" onclick="commit(3)">
      `
    }

    /**서버사이드 이벤트 emit**/
    async function commit() {
      const option=parseInt(arguments[0])
      switch (option) {
        // insert
        case 0:
          socket.emit('insert',{
            tableName: document.getElementById('table').value,
            field: document.getElementById('field').value,
            value: document.getElementById('values').value
          })
          document.getElementById('table').value=''
          document.getElementById('field').value=''
          document.getElementById('values').value=''
          break;
        // select
        case 1:
          socket.emit('select', {
            tableName: document.getElementById('table').value,
            field: document.getElementById('columns').value,
            whereParameter: document.getElementById('where').value
          })
          document.getElementById('table').value=''
          document.getElementById('columns').value=''
          document.getElementById('where').value=''
          break;
        // update
        case 2:
          socket.emit('update',{
            tableName: document.getElementById('table').value,
            setParameter: document.getElementById('set').value,
            whereParameter: document.getElementById('where').value
          })
          document.getElementById('table').value=''
          document.getElementById('set').value=''
          document.getElementById('where').value=''
          break;
        // delete
        case 3:
          socket.emit('delete',{
            tableName: document.getElementById('table').value,
            whereParameter: document.getElementById('where').value
          })
          document.getElementById('table').value=''
          document.getElementById('where').value=''
          break;
      }
    }
  </script>
</head>
<body class="p-3 m-0 border-0 bd-example">
<nav class="navbar sticky-top bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Node.js DAO</a>
  </div>
</nav>
<div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dropdown button
  </button>
  <ul class="dropdown-menu" style="">
    <li><a class="dropdown-item" onclick="dao_insert()" href="#">Insert</a></li>
    <li><a class="dropdown-item" onclick="dao_select()" href="#">Select</a></li>
    <li><a class="dropdown-item" onclick="dao_update()" href="#">Update</a></li>
    <li><a class="dropdown-item" onclick="dao_delete()" href="#">Delete</a></li>
  </ul>
</div>
<br>
<br>
<h2 id="title"><span id="option" class="badge bg-secondary"></span></h2>
<br>
<div id="dao"></div>

<br>
<div id="result"></div>
</body>

<script>

</script>
</html>